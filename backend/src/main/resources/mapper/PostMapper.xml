<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="me.muheun.moaspace.mapper.PostMapper">

    <!-- 해시태그 개수 조회 -->
    <select id="countByHashtag" resultType="long">
        SELECT COUNT(*)
        FROM posts p
        WHERE #{hashtag} = ANY(p.hashtags)
          AND p.deleted = false
    </select>

    <!-- 해시태그로 게시글 검색 -->
    <select id="findByHashtag" resultType="me.muheun.moaspace.domain.post.Post">
        SELECT p.*
        FROM posts p
        WHERE #{hashtag} = ANY(p.hashtags)
          AND p.deleted = #{deleted}
        ORDER BY p.created_at DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 해시태그 검색 전체 개수 -->
    <select id="countByHashtagForSearch" resultType="long">
        SELECT COUNT(*)
        FROM posts p
        WHERE #{hashtag} = ANY(p.hashtags)
          AND p.deleted = #{deleted}
    </select>

</mapper>
