spring:
  application:
    name: moaspace

  datasource:
    url: ${DB_JDBC_URL}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      pool-name: HikariCP-Vector

  # Flyway 마이그레이션
  flyway:
    enabled: true
    baseline-on-migrate: true
    baseline-version: 1
    locations: classpath:db/migration
    validate-on-migrate: true
    out-of-order: false
    placeholder-replacement: false

  # Spring Cache 설정
  cache:
    type: caffeine
    cache-names: vectorConfig
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=5m

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        jdbc:
          batch_size: 50
          time_zone: UTC
        order_inserts: true
        order_updates: true
    open-in-view: false

  # Google OAuth2 설정
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope:
              - email
              - profile
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            authorization-grant-type: authorization_code

# MyBatis 설정
mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: me.muheun.moaspace.query.dto
  configuration:
    map-underscore-to-camel-case: true

server:
  port: 8080

logging:
  level:
    root: INFO
    me.muheun.moaspace: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{requestId}] %-5level %logger{36} - %msg%n"

# JWT 설정
jwt:
  secret: ${JWT_SECRET}
  access-token-expiration: 3600000  # 1시간 (밀리초)
  refresh-token-expiration: 604800000  # 7일 (밀리초)

# Frontend URL 설정 (OAuth2 리다이렉트용)
frontend:
  url: ${FRONTEND_URL:http://localhost:3000}

# 벡터 시스템 설정
vector:
  # 네임스페이스 설정 (멀티테넌시 격리 단위)
  namespace: ${VECTOR_NAMESPACE:moaspace}
  multi-tenant: false

  # 임베딩 설정
  embedding:
    provider: onnx
    model-path: ${ONNX_MODEL_PATH}
    tokenizer-path: ${ONNX_TOKENIZER_PATH}
    dimension: 768
    max-tokens: 512
    max-concurrent: 4  # Semaphore 최대 동시 실행 개수 (thread-safety 보장)

  # 벡터 인덱싱 설정
  indexing:
    # 청킹 설정
    chunking:
      max-tokens-per-chunk: 200  # 청크당 최대 토큰 수
      target-tokens-per-chunk: 150  # 청크당 목표 토큰 수
      overlap-tokens: 50  # 청크 간 오버랩 토큰 수

    # 엔티티별 필드 가중치
    field-weights:
      posts:
        weights:
          title: 0.6  # 제목 가중치 60%
          content: 0.4  # 본문 가중치 40%

    # 기본 설정값
    defaults:
      search-limit: 10  # 검색 시 기본 limit
